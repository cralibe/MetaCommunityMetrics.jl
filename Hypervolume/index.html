<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Hypervolume Functions · MetaCommunityMetrics Documentation</title><meta name="title" content="Hypervolume Functions · MetaCommunityMetrics Documentation"/><meta property="og:title" content="Hypervolume Functions · MetaCommunityMetrics Documentation"/><meta property="twitter:title" content="Hypervolume Functions · MetaCommunityMetrics Documentation"/><meta name="description" content="Documentation for MetaCommunityMetrics Documentation."/><meta property="og:description" content="Documentation for MetaCommunityMetrics Documentation."/><meta property="twitter:description" content="Documentation for MetaCommunityMetrics Documentation."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="MetaCommunityMetrics Documentation logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">MetaCommunityMetrics Documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../BetaDiversity/">Beta Diverisity Functions</a></li><li><a class="tocitem" href="../DNCI/">Dispersal-Niche Continuum Index (DNCI) Functions</a></li><li><a class="tocitem" href="../NicheOverlapIndex/">Niche Overlap Index Function</a></li><li><a class="tocitem" href="../OccupiedPatchesProportion/">Occupied Patches Proportion Function</a></li><li><a class="tocitem" href="../VariabilityMetrics/">Variability Metrics Functions</a></li><li class="is-active"><a class="tocitem" href>Hypervolume Functions</a><ul class="internal"><li><a class="tocitem" href="#Functionality-Overview"><span>Functionality Overview</span></a></li><li><a class="tocitem" href="#The-Functions"><span>The Functions</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../Validation/">Validation</a></li><li><a class="tocitem" href="../Benchmarking/">Benchmark Results</a></li><li><a class="tocitem" href="../Example/">Demonstration on rodent metacommunity data</a></li><li><a class="tocitem" href="../Acknowledgment/">Acknowledgment</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Hypervolume Functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Hypervolume Functions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/cralibe/MetaCommunityMetrics.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Hypervolume-Functions"><a class="docs-heading-anchor" href="#Hypervolume-Functions">Hypervolume Functions</a><a id="Hypervolume-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Hypervolume-Functions" title="Permalink"></a></h1><p>Hypervolume is a concept originally proposed by Hutchinson (1957). It provides a framework to calculate the volume of a niche for a given species and thus the niche overlap between two species. It helps to infer how niche breath of species has contributed to the co-occurence of different species in the same location at the same time. Unlike the other metrics in this package which require only abundance or occurrence data, this framework also requires environmental data. The hypervolume functions provide by this package are adapted from the R package <code>MVNH</code> (https://github.com/lvmuyang/MVNH).</p><h2 id="Functionality-Overview"><a class="docs-heading-anchor" href="#Functionality-Overview">Functionality Overview</a><a id="Functionality-Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Functionality-Overview" title="Permalink"></a></h2><p>The MVNH framework provides parametric measures for analyzing ecological niches using the multivariate normal distribution model. This framework offers powerful tools for quantifying and comparing the size and dissimilarity of species&#39; niches. There are four hypervolume functions in this package:</p><ul><li><code>MVNH_det()</code> calculates the total hypervolume of a species&#39; niche based on the determinant of the covariance matrix.</li><li><code>MVNH_dissimilarity()</code> calculates the Bhattacharyya distance between two species&#39; niches, providing a comprehensive measure of niche differentiation. </li><li><code>average_MVNH_det()</code> calculates the mean hypervolume across multiple species in a community, providing an overall measure of niche size at the community level.</li><li><code>average_MVNH_dissimilarity()</code> calculates the mean Bhattacharyya distance between all unique pairs of species in a community, providing a measure of overall niche differentiation.</li></ul><h3 id="Practical-Considerations"><a class="docs-heading-anchor" href="#Practical-Considerations">Practical Considerations</a><a id="Practical-Considerations-1"></a><a class="docs-heading-anchor-permalink" href="#Practical-Considerations" title="Permalink"></a></h3><ul><li><p>Statistical assumptions: This framework relies on multivariate normal distribution of environmental data.</p><ul><li>When encountering skewed variables, apply appropriate transformations to achieve approximately normal distributions</li><li>Be aware that as you increase the number of variables, you face greater challenges with:<ul><li>Variable interdependence (collinearity) which can drive determinant values toward zero</li><li>Potential violations of the multivariate normality assumption</li></ul></li><li>Address variable interdependence through either:<ul><li>Thoughtful pre-selection of ecologically meaningful variables with direct influence on species distributions</li><li>Application of dimension reduction methods such as PCA (principal component analysis)</li></ul></li></ul></li><li><p>Measurement standardization: Before analysis, standardize all environmental variables to comparable scales to prevent variables with larger numerical ranges from disproportionately influencing results.</p></li><li><p>Species that only occupied one site should be removed before using these functions to avoid undefined values.</p></li></ul><h2 id="The-Functions"><a class="docs-heading-anchor" href="#The-Functions">The Functions</a><a id="The-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#The-Functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MetaCommunityMetrics.MVNH_det" href="#MetaCommunityMetrics.MVNH_det"><code>MetaCommunityMetrics.MVNH_det</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MVNH_det(env_data::DataFrame; var_names::Vector{String}=String[]) -&gt; DataFrame</code></pre><p>Calculate the niche hypervolume of a species based on environmental variables.</p><p>Arguments</p><ul><li><code>env_data::DataFrame</code>: DataFrame where each row represents an observation of a species (presence only, need to filter out absences) and columns represent environmental variables.</li><li><code>var_names::Vector{String}=String[]</code>: Optional vector specifying names for the environmental variables. If empty, default names &quot;variable1&quot;, &quot;variable2&quot;, etc. will be used.</li></ul><p>Returns <code>DataFrame</code>: A DataFrame containing:     - <code>Correlation</code>: The correlation component (calculated as det(COV)/prod(variances))     - One column for each environmental variable showing its variance     - <code>total</code>: The total hypervolume (calculated as the determinant of the covariance matrix)</p><p>Details</p><ul><li>Environmental variables are assumed to follow a multivariate normal distribution, otherwise transformation to normal distribution is recommended before using this function.</li><li>Variables should be standardized before using this function to avoid bias from different scales</li><li>The function computes the covariance matrix of the input data, extracts variances, and calculates the determinant</li><li>This function is a Julia implementation of the <code>MVNH_det()</code> function from the R package <code>MVNH</code> (GPL-3)</li><li>Original package and documentation: https://github.com/lvmuyang/MVNH</li></ul><p>Example</p><pre><code class="language-jildoctest hljs">julia&gt; using MetaCommunityMetrics, Pipe, DataFrames, Statistics, UnicodePlots

julia&gt; df = load_sample_data()
53352×12 DataFrame
   Row │ Year   Month  Day    Sampling_date_order  plot   Species  Abundance  Presence  Latitude  Longitude  standardized_temperature  standardized_precipitation 
       │ Int64  Int64  Int64  Int64                Int64  String3  Int64      Int64     Float64   Float64    Float64                 Float64                  
───────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     1 │  2010      1     16                    1      1  BA               0         0      35.0     -110.0                0.829467              -1.4024
     2 │  2010      1     16                    1      2  BA               0         0      35.0     -109.5               -1.12294               -0.0519895
     3 │  2010      1     16                    1      4  BA               0         0      35.0     -108.5               -0.409808              -0.803663
     4 │  2010      1     16                    1      8  BA               0         0      35.5     -109.5               -1.35913               -0.646369
     5 │  2010      1     16                    1      9  BA               0         0      35.5     -109.0                0.0822                 1.09485
   ⋮   │   ⋮      ⋮      ⋮             ⋮             ⋮       ⋮         ⋮         ⋮         ⋮          ⋮                ⋮                        ⋮
 53348 │  2023      3     21                  117      9  SH               0         0      35.5     -109.0               -0.571565              -0.836345
 53349 │  2023      3     21                  117     10  SH               0         0      35.5     -108.5               -2.33729               -0.398522
 53350 │  2023      3     21                  117     12  SH               1         1      35.5     -107.5                0.547169               1.03257
 53351 │  2023      3     21                  117     16  SH               0         0      36.0     -108.5               -0.815015               0.95971
 53352 │  2023      3     21                  117     23  SH               0         0      36.5     -108.0                0.48949               -1.59416
                                                                                                                                            53342 rows omitted

julia&gt; env_data = @pipe df |&gt; 
            filter(row -&gt; row[:Presence] &gt; 0, _) |&gt;
            filter(row -&gt; row[:Species] == &quot;BA&quot;, _) |&gt;
            select(_, [:standardized_temperature, :standardized_precipitation])
143×2 DataFrame
 Row │ standardized_temperature  standardized_precipitation 
     │ Float64                 Float64                  
─────┼──────────────────────────────────────────────────
   1 │            -0.37813                    0.13009
   2 │            -0.00856861                 0.237183
   3 │            -0.664638                  -0.772406
   4 │             2.05431                    0.451875
   5 │            -0.39968                   -0.719024
  ⋮  │           ⋮                        ⋮
 139 │             1.85574                   -0.583737
 140 │             0.0953878                  1.21099
 141 │            -1.02227                    1.33501
 142 │            -0.400246                  -0.438892
 143 │            -0.817817                   0.418038
                                        133 rows omitted

julia&gt; result = MVNH_det(env_data; var_names=[&quot;Temperature&quot;, &quot;Precipitation&quot;])
1×4 DataFrame
 Row │ total    correlation  Temperature  Precipitation 
     │ Float64  Float64      Float64      Float64       
─────┼──────────────────────────────────────────────────
   1 │ 1.15268     0.999732     0.962495        1.19792</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cralibe/MetaCommunityMetrics.jl">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MetaCommunityMetrics.MVNH_dissimilarity" href="#MetaCommunityMetrics.MVNH_dissimilarity"><code>MetaCommunityMetrics.MVNH_dissimilarity</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MVNH_dissimilarity(env_data_1::DataFrame, env_data_2::DataFrame; var_names::Vector{String}=String[]) -&gt; DataFrame</code></pre><p>Calculate niche dissimilarity between two species based on their environmental variables, using the Bhattacharyya distance and its components.</p><p>Arguments</p><ul><li><code>env_data_1::DataFrame</code>: DataFrame for the first species, where each row represents an observation (presence only, need to filter out absences) and columns represent environmental variables.</li><li><code>env_data_2::DataFrame</code>: DataFrame for the second species, with the same structure as <code>data_1</code>.</li><li><code>var_names::Vector{String}=String[]</code>: Optional vector specifying names for the environmental variables. If empty, default names &quot;variable1&quot;, &quot;variable2&quot;, etc. will be used.</li></ul><p>Returns <code>DataFrame</code>: A dataframe containing three metrics and their components:     - <code>&quot;Bhattacharyya_distance&quot;</code>: The total Bhattacharyya distance and its components     - <code>&quot;Mahalanobis_distance&quot;</code>: The Mahalanobis component of the Bhattacharyya distance     - <code>&quot;Determinant_ratio&quot;</code>: The determinant ratio component of the Bhattacharyya distance</p><p>Each metric contains:     - <code>total</code>: The total value of the respective distance measure     - <code>correlation</code>: The correlation component of the distance measure     - One value for each environmental variable showing its contribution to the distance</p><p><strong>Details</strong></p><ul><li>The Bhattacharyya distance is calculated as the sum of two components:<ol><li>Mahalanobis component: (1/8) × (μ₁-μ₂)ᵀ × (S₁+S₂)/2⁻¹ × (μ₁-μ₂)</li><li>Determinant ratio component: (1/2) × log(det((S₁+S₂)/2) / sqrt(det(S₁) × det(S₂)))</li></ol></li><li>Each component is further decomposed into individual variable contributions and correlation effects</li><li>Environmental variables are assumed to follow a multivariate normal distribution, otherwise transformation to normal distribution is recommended before using this function.</li><li>Variables should be standardized_ before using this function to avoid bias from different scales</li><li>This function is a Julia implementation inspired by the <code>MVNH</code> R package (GPL-3)</li><li>Original package and documentation: https://github.com/lvmuyang/MVNH</li></ul><p>Example</p><pre><code class="language-jildoctest hljs">julia&gt; using MetaCommunityMetrics, Pipe, DataFrames, Statistics

julia&gt; df = load_sample_data()
53352×12 DataFrame
   Row │ Year   Month  Day    Sampling_date_order  plot   Species  Abundance  Presence  Latitude  Longitude  standardized_temperature  standardized_precipitation 
       │ Int64  Int64  Int64  Int64                Int64  String3  Int64      Int64     Float64   Float64    Float64                 Float64                  
───────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     1 │  2010      1     16                    1      1  BA               0         0      35.0     -110.0                0.829467              -1.4024
     2 │  2010      1     16                    1      2  BA               0         0      35.0     -109.5               -1.12294               -0.0519895
     3 │  2010      1     16                    1      4  BA               0         0      35.0     -108.5               -0.409808              -0.803663
     4 │  2010      1     16                    1      8  BA               0         0      35.5     -109.5               -1.35913               -0.646369
     5 │  2010      1     16                    1      9  BA               0         0      35.5     -109.0                0.0822                 1.09485
   ⋮   │   ⋮      ⋮      ⋮             ⋮             ⋮       ⋮         ⋮         ⋮         ⋮          ⋮                ⋮                        ⋮
 53348 │  2023      3     21                  117      9  SH               0         0      35.5     -109.0               -0.571565              -0.836345
 53349 │  2023      3     21                  117     10  SH               0         0      35.5     -108.5               -2.33729               -0.398522
 53350 │  2023      3     21                  117     12  SH               1         1      35.5     -107.5                0.547169               1.03257
 53351 │  2023      3     21                  117     16  SH               0         0      36.0     -108.5               -0.815015               0.95971
 53352 │  2023      3     21                  117     23  SH               0         0      36.5     -108.0                0.48949               -1.59416
                                                                                                                                            53342 rows omitted


julia&gt; env_data_1 = @pipe df |&gt; 
            filter(row -&gt; row[:Presence] &gt; 0, _) |&gt;
            filter(row -&gt; row[:Species] == &quot;BA&quot;, _) |&gt;
            select(_, [:standardized_temperature, :standardized_precipitation])

143×2 DataFrame
 Row │ standardized_temperature  standardized_precipitation 
     │ Float64                 Float64                  
─────┼──────────────────────────────────────────────────
   1 │            -0.37813                    0.13009
   2 │            -0.00856861                 0.237183
   3 │            -0.664638                  -0.772406
   4 │             2.05431                    0.451875
   5 │            -0.39968                   -0.719024
  ⋮  │           ⋮                        ⋮
 139 │             1.85574                   -0.583737
 140 │             0.0953878                  1.21099
 141 │            -1.02227                    1.33501
 142 │            -0.400246                  -0.438892
 143 │            -0.817817                   0.418038
                                        133 rows omitted

julia&gt; env_data_2 = @pipe df |&gt; 
            filter(row -&gt; row[:Presence] &gt; 0, _) |&gt;
            filter(row -&gt; row[:Species] == &quot;SH&quot;, _) |&gt;
            select(_, [:standardized_temperature, :standardized_precipitation])
58×2 DataFrame
 Row │ standardized_temperature  standardized_precipitation 
     │ Float64                 Float64                  
─────┼──────────────────────────────────────────────────
   1 │              -0.229864                  1.84371
   2 │               0.460218                 -0.624328
   3 │              -1.03283                  -1.16451
   4 │               0.675006                 -0.120586
   5 │               0.40729                   0.20034
  ⋮  │           ⋮                        ⋮
  54 │              -0.870299                 -0.235392
  55 │               0.504555                 -1.50887
  56 │               2.03065                  -0.740789
  57 │              -0.174396                  0.448461
  58 │               0.547169                  1.03257
                                         48 rows omitted
                   
julia&gt; result = MVNH_dissimilarity(env_data_1, env_data_2; var_names=[&quot;Temperature&quot;, &quot;Precipitation&quot;])
3×5 DataFrame
 Row │ metric                  total       correlation  Temperature  Precipitation 
     │ String                  Float64     Float64      Float64      Float64       
─────┼─────────────────────────────────────────────────────────────────────────────
   1 │ Bhattacharyya_distance  0.00980771  0.00015205    0.00388058     0.00577508
   2 │ Mahalanobis_distance    0.00664862  5.06232e-6    0.00234902     0.00429454
   3 │ Determinant_ratio       0.00315908  0.000146988   0.00153156     0.00148054</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cralibe/MetaCommunityMetrics.jl">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MetaCommunityMetrics.average_MVNH_det" href="#MetaCommunityMetrics.average_MVNH_det"><code>MetaCommunityMetrics.average_MVNH_det</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">average_MVNH_det(env_data::DataFrame, presence_absence::Vector{Int}, species::AbstractVector; 
                 var_names::Vector{String}=String[]) -&gt; Float64</code></pre><p>Calculate the average niche hypervolume across multiple species in a community dataset.</p><p>Arguments</p><ul><li><code>env_data::DataFrame</code>: DataFrame containing environmental variables where each row represents an observation.</li><li><code>presence_absence::Vector{Int}</code>: Vector indicating presence (1) or absence (0) for each observation in <code>data</code>.</li><li><code>species::AbstractVector</code>: Vector containing species identifiers corresponding to each observation in <code>data</code>, which must be a vector of strings.</li><li><code>var_names::Vector{String}=String[]</code>: Optional vector specifying names for the environmental variables. If empty, default names will be used.</li></ul><p>Returns</p><ul><li><code>Float64</code>: The average hypervolume across all species with presence data.</li></ul><p>Details</p><ul><li>For each unique species, the function:<ol><li>Filters observations where the species is present (presence_absence &gt; 0)</li><li>Calculates the niche hypervolume using the <code>MVNH_det</code> function</li><li>Extracts the total hypervolume value</li></ol></li><li>The function then computes the mean of all individual species hypervolumes.</li><li>Species with no presence data are skipped in the calculation.</li><li>Environmental variables are assumed to follow a multivariate normal distribution, otherwise transformation to normal distribution is recommended before using this function.</li><li>User should standardize the environmental variables before using this function to avoid bias from different scales. So user should transform them to normal distribution when necessary.</li><li>User should remove singletons (species only occupied one site) before using this function to avoid NaN values in the hypervolume calculation.</li></ul><p>Example</p><pre><code class="language-jildoctest hljs">julia&gt; using MetaCommunityMetrics, Pipe, DataFrames, Statistics

julia&gt; df = @pipe load_sample_data() |&gt;
                      groupby(_, :Species) |&gt;
                      filter(row -&gt; sum(row.Presence) &gt; 1, _)|&gt;
                      DataFrame(_)
53352×12 DataFrame
   Row │ Year   Month  Day    Sampling_date_order  plot   Species  Abundance  Presence  Latitude  Longitude  standardized_temperature  standardized_precipitation 
       │ Int64  Int64  Int64  Int64                Int64  String3  Int64      Int64     Float64   Float64    Float64                 Float64                  
───────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     1 │  2010      1     16                    1      1  BA               0         0      35.0     -110.0                0.829467              -1.4024
     2 │  2010      1     16                    1      2  BA               0         0      35.0     -109.5               -1.12294               -0.0519895
     3 │  2010      1     16                    1      4  BA               0         0      35.0     -108.5               -0.409808              -0.803663
     4 │  2010      1     16                    1      8  BA               0         0      35.5     -109.5               -1.35913               -0.646369
     5 │  2010      1     16                    1      9  BA               0         0      35.5     -109.0                0.0822                 1.09485
   ⋮   │   ⋮      ⋮      ⋮             ⋮             ⋮       ⋮         ⋮         ⋮         ⋮          ⋮                ⋮                        ⋮
 53348 │  2023      3     21                  117      9  SH               0         0      35.5     -109.0               -0.571565              -0.836345
 53349 │  2023      3     21                  117     10  SH               0         0      35.5     -108.5               -2.33729               -0.398522
 53350 │  2023      3     21                  117     12  SH               1         1      35.5     -107.5                0.547169               1.03257
 53351 │  2023      3     21                  117     16  SH               0         0      36.0     -108.5               -0.815015               0.95971
 53352 │  2023      3     21                  117     23  SH               0         0      36.5     -108.0                0.48949               -1.59416
                                                                                                                                            53342 rows omitted

julia&gt; env_data = @pipe df |&gt; 
           select(_, [:standardized_temperature, :standardized_precipitation]) 
53352×2 DataFrame
   Row │ standardized_temperature  standardized_precipitation 
       │ Float64                 Float64                  
───────┼──────────────────────────────────────────────────
     1 │               0.829467              -1.4024
     2 │              -1.12294               -0.0519895
     3 │              -0.409808              -0.803663
     4 │              -1.35913               -0.646369
     5 │               0.0822                 1.09485
   ⋮   │           ⋮                        ⋮
 53348 │              -0.571565              -0.836345
 53349 │              -2.33729               -0.398522
 53350 │               0.547169               1.03257
 53351 │              -0.815015               0.95971
 53352 │               0.48949               -1.59416
                                        53342 rows omitted

julia&gt; result = average_MVNH_det(env_ata, df.Presence, df.Species; var_names=[&quot;Temperature&quot;, &quot;Precipitation&quot;])
1.2103765096417536</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cralibe/MetaCommunityMetrics.jl">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MetaCommunityMetrics.average_MVNH_dissimilarity" href="#MetaCommunityMetrics.average_MVNH_dissimilarity"><code>MetaCommunityMetrics.average_MVNH_dissimilarity</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">average_MVNH_dissimilarity(env_data::DataFrame, presence_absence::Vector{Int}, species::AbstractVector; 
                          var_names::Vector{String}=String[]) -&gt; Float64</code></pre><p>Calculate the average niche dissimilarity between all unique pairs of species in a community dataset using Bhattacharyya distance.</p><p>Arguments</p><ul><li><code>env_data::DataFrame</code>: DataFrame containing environmental variables where each row represents an observation.</li><li><code>presence_absence::Vector{Int}</code>: Vector indicating presence (1) or absence (0) for each observation in <code>data</code>.</li><li><code>species::AbstractVector</code>: Vector containing species identifiers corresponding to each observation in <code>data</code>, which must be a vector of strings.</li><li><code>var_names::Vector{String}=String[]</code>: Optional vector specifying names for the environmental variables. If empty, default names will be used.</li></ul><p>Returns</p><ul><li><code>Float64</code>: The average Bhattacharyya distance across all unique species pairs.</li></ul><p>Details</p><ul><li>For each unique pair of species, the function:<ol><li>Filters observations where each species is present (presence_absence &gt; 0)</li><li>Calculates the niche dissimilarity using the <code>MVNH_dissimilarity</code> function</li><li>Extracts the total Bhattacharyya distance value</li></ol></li><li>The function then computes the mean of all pairwise Bhattacharyya distances</li><li>Species pairs where either species has no presence data are skipped</li><li>Each species pair is processed only once (i.e., sp1-sp2 is calculated, but sp2-sp1 is skipped)</li><li>Environmental variables are assumed to follow a multivariate normal distribution. So user should transform them to normal distribution when necessary.</li><li>User should standardize the environmental variables before using this function to avoid bias from different scales.</li><li>User should remove singletons (species only occupied one site) before using this function to avoid NaN values in the hypervolume calculation.</li></ul><p>Example</p><pre><code class="language-jildoctest hljs">julia&gt; using MetaCommunityMetrics, Pipe, DataFrames, Statistics

julia&gt; df = @pipe load_sample_data() |&gt;
                      groupby(_, :Species) |&gt;
                      filter(row -&gt; sum(row.Presence) &gt; 1, _)|&gt;
                      DataFrame(_)
53352×12 DataFrame
   Row │ Year   Month  Day    Sampling_date_order  plot   Species  Abundance  Presence  Latitude  Longitude  standardized_temperature  standardized_precipitation 
       │ Int64  Int64  Int64  Int64                Int64  String3  Int64      Int64     Float64   Float64    Float64                 Float64                  
───────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     1 │  2010      1     16                    1      1  BA               0         0      35.0     -110.0                0.829467              -1.4024
     2 │  2010      1     16                    1      2  BA               0         0      35.0     -109.5               -1.12294               -0.0519895
     3 │  2010      1     16                    1      4  BA               0         0      35.0     -108.5               -0.409808              -0.803663
     4 │  2010      1     16                    1      8  BA               0         0      35.5     -109.5               -1.35913               -0.646369
     5 │  2010      1     16                    1      9  BA               0         0      35.5     -109.0                0.0822                 1.09485
   ⋮   │   ⋮      ⋮      ⋮             ⋮             ⋮       ⋮         ⋮         ⋮         ⋮          ⋮                ⋮                        ⋮
 53348 │  2023      3     21                  117      9  SH               0         0      35.5     -109.0               -0.571565              -0.836345
 53349 │  2023      3     21                  117     10  SH               0         0      35.5     -108.5               -2.33729               -0.398522
 53350 │  2023      3     21                  117     12  SH               1         1      35.5     -107.5                0.547169               1.03257
 53351 │  2023      3     21                  117     16  SH               0         0      36.0     -108.5               -0.815015               0.95971
 53352 │  2023      3     21                  117     23  SH               0         0      36.5     -108.0                0.48949               -1.59416
                                                                                                                                            53342 rows omitted

julia&gt; env_data = @pipe df |&gt; 
           select(_, [:standardized_temperature, :standardized_precipitation])    
53352×2 DataFrame
   Row │ standardized_temperature  standardized_precipitation 
       │ Float64                 Float64                  
───────┼──────────────────────────────────────────────────
     1 │               0.829467              -1.4024
     2 │              -1.12294               -0.0519895
     3 │              -0.409808              -0.803663
     4 │              -1.35913               -0.646369
     5 │               0.0822                 1.09485
   ⋮   │           ⋮                        ⋮
 53348 │              -0.571565              -0.836345
 53349 │              -2.33729               -0.398522
 53350 │               0.547169               1.03257
 53351 │              -0.815015               0.95971
 53352 │               0.48949               -1.59416
                                        53342 rows omitted

julia&gt; result = average_MVNH_dissimilarity(env_data, df.Presence, df.Species; var_names=[&quot;Temperature&quot;, &quot;Precipitation&quot;])     
0.03059942936454443</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cralibe/MetaCommunityMetrics.jl">source</a></section></article><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li>Lu, M., Winner, K., &amp; Jetz, W. (2021). A unifying framework for quantifying and comparing n‐dimensional hypervolumes. Methods in Ecology and Evolution, 12(10), 1953-1968. https://doi.org/10.1111/2041-210X.13665</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../VariabilityMetrics/">« Variability Metrics Functions</a><a class="docs-footer-nextpage" href="../Validation/">Validation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.3 on <span class="colophon-date" title="Wednesday 22 October 2025 16:19">Wednesday 22 October 2025</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
